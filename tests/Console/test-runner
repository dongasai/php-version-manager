#!/usr/bin/env php
<?php

// 自动加载
$autoloadPaths = [
    __DIR__ . '/../../vendor/autoload.php',
    __DIR__ . '/../../../../autoload.php',
];

$loaded = false;
foreach ($autoloadPaths as $file) {
    if (file_exists($file)) {
        require $file;
        $loaded = true;
        break;
    }
}

if (!$loaded) {
    echo 'You need to set up the project dependencies using Composer:' . PHP_EOL . PHP_EOL;
    echo '    composer install' . PHP_EOL . PHP_EOL;
    exit(1);
}

// 添加测试命名空间自动加载
spl_autoload_register(function ($class) {
    // 检查是否是测试命名空间
    if (strpos($class, 'Tests\\') === 0) {
        $file = __DIR__ . '/../../' . str_replace('\\', '/', substr($class, 6)) . '.php';
        if (file_exists($file)) {
            require $file;
            return true;
        }
    }
    return false;
});

use Symfony\Component\Console\Application;
use Tests\Console\Command\RunTestCommand;

// 创建应用
$application = new Application('PVM Test Runner', '1.0.0');

// 添加命令
$application->add(new RunTestCommand());

// 设置默认命令
$application->setDefaultCommand('test:run', true);

// 运行应用
$application->run();
